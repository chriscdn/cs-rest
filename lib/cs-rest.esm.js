import e from"is-object";import t from"lodash.get";import o from"axios";import r from"lodash.isnil";function n(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(n=function(){return!!e})()}function i(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function a(e,t,o){return t&&s(e.prototype,t),o&&s(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},u.apply(this,arguments)}function l(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,p(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function d(e){var t="function"==typeof Map?new Map:void 0;return d=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return function(e,t,o){if(n())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return o&&p(i,o.prototype),i}(e,arguments,c(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),p(o,e)},d(e)}var m,h=/*#__PURE__*/function(t){function o(o,r,n){var i;if(void 0===o&&(o="Internal error"),void 0===r&&(r=null),void 0===n&&(n=-32603),e(o)){var s=o;(i=t.call(this,s.message)||this).code=void 0,i.data=void 0,i.code=s.code,i.data=s.data}else(i=t.call(this,o)||this).code=void 0,i.data=void 0,i.code=n,i.data=r;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i)}return l(o,t),o}(/*#__PURE__*/d(Error)),f={index:0,get next(){return this.index=this.index+1,this.index}},v=/*#__PURE__*/function(){function e(e,t){this.session=void 0,this.relativePath=void 0,this._batchQueue=void 0,this.session=e,this.relativePath=t,this.resetQueue()}var o=e.prototype;return o.requestObject=function(e,t,o){return{jsonrpc:"2.0",method:e,id:o,params:t}},o.handleResponse=function(e){if(Object.prototype.hasOwnProperty.call(e,"result"))return e.result;if(Object.prototype.hasOwnProperty.call(e,"error")){var t=e.error;throw new h(t.message,t.data,t.code)}throw Error("The server did not respond correctly.")},o.request=function(e,t,o){try{var r=this;return void 0===o&&(o=f.next),Promise.resolve(r.session.postBody(r.relativePath,{rpc:r.requestObject(e,t,o)})).then(function(e){return r.handleResponse(e.data)})}catch(e){return Promise.reject(e)}},o.resetQueue=function(){this._batchQueue=[]},o.queue=function(e,t,o){return void 0===o&&(o=f.next),this._batchQueue.push(this.requestObject(e,t,o)),this},o.batch=function(e){void 0===e&&(e=!1);try{var o=this,r=o._batchQueue;return o.resetQueue(),Promise.resolve(o.session.postBody(o.relativePath,{rpc:r})).then(function(r){return t(r,"data.data",[]).map(function(t){if(e)return o.handleResponse(t);try{return o.handleResponse(t)}catch(e){return e}})})}catch(e){return Promise.reject(e)}},o.rhnode=function(e,t,o,r){return void 0===o&&(o=[]),void 0===r&&(r=f.next),this.request(t,{dataid:e,args:o},r)},o.rhnodeQueue=function(e,t,o,r){return void 0===o&&(o=[]),void 0===r&&(r=f.next),this.queue(t,{dataid:e,args:o},r)},e}();!function(e){e[e.AssocType=-18]="AssocType",e[e.BooleanType=5]="BooleanType",e[e.ClassType=9]="ClassType",e[e.DapiNodeType=-72]="DapiNodeType",e[e.DapiSessionType=-74]="DapiSessionType",e[e.DapiStreamType=-68]="DapiStreamType",e[e.DapiVersionType=-69]="DapiVersionType",e[e.DateType=-7]="DateType",e[e.DynamicType=-127]="DynamicType",e[e.ErrorType=1]="ErrorType",e[e.FileType=-107]="FileType",e[e.FrameType=10]="FrameType",e[e.IntegerType=2]="IntegerType",e[e.JavaObjectType=-42]="JavaObjectType",e[e.ListType=-2]="ListType",e[e.LongType=-8]="LongType",e[e.ObjectType=-128]="ObjectType",e[e.ObjRefType=3]="ObjRefType",e[e.RealType=-4]="RealType",e[e.RecArrayType=-110]="RecArrayType",e[e.RecordType=-109]="RecordType",e[e.ScriptType=-3]="ScriptType",e[e.SocketType=-102]="SocketType",e[e.StringType=-1]="StringType",e[e.UAPIType=-196]="UAPIType",e[e.UndefinedType=0]="UndefinedType",e[e.VoidType=8]="VoidType",e[e.WAPIWorkType=-75]="WAPIWorkType"}(m||(m={}));var y,P=function(){return"undefined"==typeof window},b=function(){return P()?new(require("form-data")):new FormData},T=/*#__PURE__*/function(){return a(function(e){this._session=void 0,this._session=e},[{key:"session",get:function(){return this._session}}])}(),C=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return l(t,e),t.prototype.auth=function(){return this.session.get("/api/v1/auth/")},t}(T);!function(e){e[e.Accession=834]="Accession",e[e.ActiveFolder=1298]="ActiveFolder",e[e.Activeview=30309]="Activeview",e[e.ActivityManager=907]="ActivityManager",e[e.Alias=1]="Alias",e[e.Appearance=480]="Appearance",e[e.AppearanceFolder=483]="AppearanceFolder",e[e.AppearancesVolume=481]="AppearancesVolume",e[e.ArchiveFolder=31711]="ArchiveFolder",e[e.BackupManager=290]="BackupManager",e[e.BackupProcess=291]="BackupProcess",e[e.BestBets=274]="BestBets",e[e.Blog=356]="Blog",e[e.BlogEntry=357]="BlogEntry",e[e.BoxFolder=530]="BoxFolder",e[e.Category=131]="Category",e[e.CategoryFolder=132]="CategoryFolder",e[e.Channel=207]="Channel",e[e.ChannelVol=209]="ChannelVol",e[e.Classification=199]="Classification",e[e.ClassificationShortcut=197]="ClassificationShortcut",e[e.ClassificationTree=196]="ClassificationTree",e[e.ClassifiedItems=194]="ClassifiedItems",e[e.Collection=298]="Collection",e[e.Column=902]="Column",e[e.Comments=345]="Comments",e[e.CommentsReply=348]="CommentsReply",e[e.CommentsVol=346]="CommentsVol",e[e.CommExpertContainer=3030338]="CommExpertContainer",e[e.CommExpertGroup=3030339]="CommExpertGroup",e[e.CommStore=3030329]="CommStore",e[e.CommTemplate=3030002]="CommTemplate",e[e.CommTemplateFolder=3030333]="CommTemplateFolder",e[e.CommTemplateVol=3030004]="CommTemplateVol",e[e.CommURLStore=3030335]="CommURLStore",e[e.CommWorkspace=3030334]="CommWorkspace",e[e.CommXSLVolume=3030205]="CommXSLVolume",e[e.CompoundDoc=136]="CompoundDoc",e[e.CompoundEMail=557]="CompoundEMail",e[e.ContentModuleFolder=3030372]="ContentModuleFolder",e[e.CSApplicationManifest=32658]="CSApplicationManifest",e[e.CSApplicationsVolume=32657]="CSApplicationsVolume",e[e.CustomView=146]="CustomView",e[e.CustomViewTemplate=844]="CustomViewTemplate",e[e.DataFlowManager=270]="DataFlowManager",e[e.DataSourceFolder=276]="DataSourceFolder",e[e.DirWalker=277]="DirWalker",e[e.Discussion=215]="Discussion",e[e.DispositionGroup=602]="DispositionGroup",e[e.Document=144]="Document",e[e.DocumentLLNode=1297]="DocumentLLNode",e[e.DocumentServer=283]="DocumentServer",e[e.Dossier=32912]="Dossier",e[e.DossierCabinet=32916]="DossierCabinet",e[e.DossierCabinetArchive=31707]="DossierCabinetArchive",e[e.DossierTemplate=32914]="DossierTemplate",e[e.DossierTemplateFolder=31709]="DossierTemplateFolder",e[e.DossierTemplatesVolume=32917]="DossierTemplatesVolume",e[e.DossierTemplateVolume=32915]="DossierTemplateVolume",e[e.DossierVolume=32913]="DossierVolume",e[e.DPSBinding=31602]="DPSBinding",e[e.DPSFolder=31601]="DPSFolder",e[e.DPSVolume=31603]="DPSVolume",e[e.DTDLLNode=335]="DTDLLNode",e[e.DynamicView=900]="DynamicView",e[e.EMail=749]="EMail",e[e.EmailConversationItems=2504]="EmailConversationItems",e[e.EnterpriseArchiveDocument=753]="EnterpriseArchiveDocument",e[e.Facet=904]="Facet",e[e.FacetFolder=905]="FacetFolder",e[e.FacetTree=903]="FacetTree",e[e.FailedFolder=1299]="FailedFolder",e[e.FixedSystemColumn=906]="FixedSystemColumn",e[e.Folder=0]="Folder",e[e.Form=223]="Form",e[e.Generation=2]="Generation",e[e.GENERICCONTENTMODULE=3030371]="GENERICCONTENTMODULE",e[e.GlobalAppearance=482]="GlobalAppearance",e[e.HoldContainer=833]="HoldContainer",e[e.HTMLConversion=282]="HTMLConversion",e[e.HTMLFormView=226]="HTMLFormView",e[e.Importer=293]="Importer",e[e.Inbox=731]="Inbox",e[e.IndexEngine=368]="IndexEngine",e[e.IndexTracer=147]="IndexTracer",e[e.IndexUpdate=281]="IndexUpdate",e[e.InternalOTDS=924]="InternalOTDS",e[e.ItemTemplateVol=541]="ItemTemplateVol",e[e.ItemTemplateVolFolder=542]="ItemTemplateVolFolder",e[e.JournalVolume=361]="JournalVolume",e[e.LibraryExtractor=259]="LibraryExtractor",e[e.LibraryObj=272]="LibraryObj",e[e.LLNodeEmailFolder=751]="LLNodeEmailFolder",e[e.LLNodeFAQ=123475]="LLNodeFAQ",e[e.LLNodeFAQEntry=123476]="LLNodeFAQEntry",e[e.LLNodeForum=123469]="LLNodeForum",e[e.LLNodeForumEntry=123470]="LLNodeForumEntry",e[e.LLNodeURQuestion=430]="LLNodeURQuestion",e[e.LLNodeURReply=432]="LLNodeURReply",e[e.Locators=422]="Locators",e[e.Mailbox=732]="Mailbox",e[e.MailStore=3030331]="MailStore",e[e.ManagedSpace=31710]="ManagedSpace",e[e.MediaType=410]="MediaType",e[e.MediaTypesContainer=414]="MediaTypesContainer",e[e.MemcachedFolder=919]="MemcachedFolder",e[e.MemcachedProcess=920]="MemcachedProcess",e[e.Merge=273]="Merge",e[e.MicroPost=1281]="MicroPost",e[e.MicroPostVolume=1282]="MicroPostVolume",e[e.MultiVolClassification=372]="MultiVolClassification",e[e.MultiVolClassificationProxy=374]="MultiVolClassificationProxy",e[e.MultiVolClassificationTree=373]="MultiVolClassificationTree",e[e.MyReservedItems=870]="MyReservedItems",e[e.MyWorkbenches=532]="MyWorkbenches",e[e.NAVMENUVOL=3030756]="NAVMENUVOL",e[e.News=208]="News",e[e.OTCIndexObj=257]="OTCIndexObj",e[e.Partition=371]="Partition",e[e.PartitionMap=370]="PartitionMap",e[e.PersonalComm=3030203]="PersonalComm",e[e.PersonalCommSystemVolume=3030003]="PersonalCommSystemVolume",e[e.PersonalCommVol=3030204]="PersonalCommVol",e[e.PersonalStagingFolder=398]="PersonalStagingFolder",e[e.PersonalWebpage=3030343]="PersonalWebpage",e[e.PhysicalItemBox=424]="PhysicalItemBox",e[e.PhysicalItemContainer=412]="PhysicalItemContainer",e[e.PhysicalItemCopy=419]="PhysicalItemCopy",e[e.PhysicalItem_non_Container=411]="PhysicalItem_non_Container",e[e.PhysObjAdmin=415]="PhysObjAdmin",e[e.PhysObjBatchLabels=418]="PhysObjBatchLabels",e[e.PhysObjCirculation=416]="PhysObjCirculation",e[e.PhysObjReports=417]="PhysObjReports",e[e.Poll=218]="Poll",e[e.Process=271]="Process",e[e.Profile=195]="Profile",e[e.Project=202]="Project",e[e.ProjectTemplate=543]="ProjectTemplate",e[e.ProjectVol=201]="ProjectVol",e[e.Prospector=384]="Prospector",e[e.ProspectorQueries=380]="ProspectorQueries",e[e.ProspectorSnapshot=387]="ProspectorSnapshot",e[e.Provenance=829]="Provenance",e[e.Proxy=260]="Proxy",e[e.PublishingFolder=31712]="PublishingFolder",e[e.PublishingFolderVolume=31713]="PublishingFolderVolume",e[e.QAFolder=441]="QAFolder",e[e.QueryFile=296]="QueryFile",e[e.QuestionVolume=431]="QuestionVolume",e[e.RecentItems=327]="RecentItems",e[e.RecordType=425]="RecordType",e[e.RecordTypesContainer=428]="RecordTypesContainer",e[e.RedForm=32918]="RedForm",e[e.RedFormVolume=32919]="RedFormVolume",e[e.Release=138]="Release",e[e.RemoteLLDataSource=381]="RemoteLLDataSource",e[e.Reply=134]="Reply",e[e.Report=299]="Report",e[e.Revision=139]="Revision",e[e.RIMSDisposition=555]="RIMSDisposition",e[e.RIMSDispositionsContainer=554]="RIMSDispositionsContainer",e[e.RIMSHoldMaintenance=552]="RIMSHoldMaintenance",e[e.RIMSRsiContainer=553]="RIMSRsiContainer",e[e.RMAdministration=556]="RMAdministration",e[e.RMClassification=551]="RMClassification",e[e.RMFolder=426]="RMFolder",e[e.RMPart=427]="RMPart",e[e.RMReportsContainer=558]="RMReportsContainer",e[e.RMThesaurus=559]="RMThesaurus",e[e.ScanConfigurationVolume=2505]="ScanConfigurationVolume",e[e.ScheduledHoldCriteria=835]="ScheduledHoldCriteria",e[e.ScriptNode=32901]="ScriptNode",e[e.SearchBroker=258]="SearchBroker",e[e.SearchEngine=369]="SearchEngine",e[e.SearchManager=269]="SearchManager",e[e.SearchReport=278]="SearchReport",e[e.SearchResultsTemplate=383]="SearchResultsTemplate",e[e.SearchTemplate=292]="SearchTemplate",e[e.Simplate=31678]="Simplate",e[e.SkyPodLLVolume=49547]="SkyPodLLVolume",e[e.SliceFolder=275]="SliceFolder",e[e.SocialObject=1280]="SocialObject",e[e.SocialObjectVolume=1283]="SocialObjectVolume",e[e.SPCJOBDESCR=797]="SPCJOBDESCR",e[e.SPCJOBDESCRFOLDER=796]="SPCJOBDESCRFOLDER",e[e.SPCVOLUME=795]="SPCVOLUME",e[e.spdcommittee=3030202]="spdcommittee",e[e.spdcommitteevol=3030201]="spdcommitteevol",e[e.spdcommitteevolume=3030001]="spdcommitteevolume",e[e.spdemail=3030130]="spdemail",e[e.Spider=280]="Spider",e[e.StorageManagement=421]="StorageManagement",e[e.SubmitVersionNode=231]="SubmitVersionNode",e[e.Task=206]="Task",e[e.TaskGroup=205]="TaskGroup",e[e.TaskList=204]="TaskList",e[e.TaskListVol=210]="TaskListVol",e[e.TaskMilestone=212]="TaskMilestone",e[e.Template=230]="Template",e[e.TemplateFolder=268]="TemplateFolder",e[e.TextDocument=145]="TextDocument",e[e.Topic=130]="Topic",e[e.Transfers=423]="Transfers",e[e.TransportBox=531]="TransportBox",e[e.TransportItem=526]="TransportItem",e[e.TransportItemPart=527]="TransportItemPart",e[e.UrgentRequests=3030330]="UrgentRequests",e[e.URL=140]="URL",e[e.VirtualFolder=899]="VirtualFolder",e[e.VolBlog=123461]="VolBlog",e[e.VolCategories=133]="VolCategories",e[e.VolClassification=198]="VolClassification",e[e.VolComments=347]="VolComments",e[e.VolDAP=987352]="VolDAP",e[e.VolDeletedItems=405]="VolDeletedItems",e[e.VolDirectory=375]="VolDirectory",e[e.VolDiscussion=143]="VolDiscussion",e[e.VolDomainWorkspace=180]="VolDomainWorkspace",e[e.VolDTD=336]="VolDTD",e[e.VolEditWorkflow=162]="VolEditWorkflow",e[e.VolFacets=901]="VolFacets",e[e.VolLibrary=141]="VolLibrary",e[e.VolOrphan=403]="VolOrphan",e[e.VolPersonalStaging=397]="VolPersonalStaging",e[e.VolPerspectives=908]="VolPerspectives",e[e.VolPhysObj=413]="VolPhysObj",e[e.VolRecMan=550]="VolRecMan",e[e.VolRelease=137]="VolRelease",e[e.VolReports=211]="VolReports",e[e.VolSystem=148]="VolSystem",e[e.VolTracer=149]="VolTracer",e[e.VolumeFolder=484]="VolumeFolder",e[e.VolumeLLVolume=1296]="VolumeLLVolume",e[e.VolWarehouse=525]="VolWarehouse",e[e.VolWorkbin=142]="VolWorkbin",e[e.VolWorkflow=161]="VolWorkflow",e[e.WarehouseFolder=529]="WarehouseFolder",e[e.WebFormConnectionVolume=236]="WebFormConnectionVolume",e[e.WebFormDatabaseConnection=235]="WebFormDatabaseConnection",e[e.WebFormLookup=234]="WebFormLookup",e[e.WebFormLookupVolume=233]="WebFormLookupVolume",e[e.WebReports=30303]="WebReports",e[e.WFMapLLNode=128]="WFMapLLNode",e[e.WFStatusNode=190]="WFStatusNode",e[e.WIKI=5573]="WIKI",e[e.WIKIPAGE=5574]="WIKIPAGE",e[e.Workbench=528]="Workbench",e[e.WorkflowAttachments=154]="WorkflowAttachments",e[e.XMLActivatorCon=286]="XMLActivatorCon",e[e.XMLActivatorProd=285]="XMLActivatorProd"}(y||(y={}));var V=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}l(t,e);var o=t.prototype;return o.addablenodetypes=function(e){return this.session.get("api/v1/nodes/"+e+"/addablenodetypes")},o.addDocument=function(e){var t=e.parent_id,o=e.fileHandler,r=e.apiVersion,n=void 0===r?"v1":r,i=e.name,s=void 0===i?void 0:i,a=e.options,l=void 0===a?{}:a;try{var c=this,p="api/"+n+"/nodes";if(P()){var d=require("fs").promises,m=require("path");return Promise.resolve(d.readFile(o)).then(function(e){var r=s||m.basename(o),n=u({},l,{type:y.Document,name:r,parent_id:t,file:{file:e,name:r}});return c.session.postForm(p,n)})}if(c.session._isFile(o)){var h=s||o.name,f=u({},l,{type:y.Document,name:h,parent_id:t,file:{file:o,name:h}});return Promise.resolve(c.session.postForm(p,f))}throw new Error("Invalid file.")}catch(e){return Promise.reject(e)}},o.addDocumentMajor=function(e){var t=e.parent_id,o=e.fileHandler,r=e.name,n=void 0===r?void 0:r,i=e.description,s=void 0===i?void 0:i,a=e.options,l=void 0===a?{}:a;try{var c=this;return Promise.resolve(c.addDocument({parent_id:t,fileHandler:o,name:n,options:u({},l,{advanced_versioning:!0})})).then(function(e){var t=e.data.id;return Promise.resolve(c.session.versions.promote({dataid:t,versionNumber:1,description:s})).then(function(){return Promise.resolve(c.session.versions.deleteVersion({dataid:t,versionNumber:1})).then(function(){return e})})})}catch(e){return Promise.reject(e)}},o.addItem=function(e,t,o,r){return void 0===r&&(r={}),this.session.postBody("api/v2/nodes",u({type:e,parent_id:t,name:o},r))},o.node=function(e){var t=e.apiVersion,o=e.params;return this.session.get("api/"+(void 0===t?"v2":t)+"/nodes/"+e.dataid,{params:void 0===o?{}:o})},o.ancestors=function(e,t){return void 0===t&&(t={}),this.session.get("api/v1/nodes/"+e+"/ancestors",{params:t})},o.volumeInfo=function(e){return this.session.get("api/v1/volumes/"+e)},o.volumes=function(){return this.session.get("api/v2/volumes")},o.addFolder=function(e,t,o){return void 0===o&&(o={}),this.addItem(y.Folder,e,t,o)},o.addGeneration=function(e,t,o,r,n){return void 0===n&&(n={}),this.addItem(y.Generation,e,t,u({original_id:o,version_number:r},n))},o.nodes=function(e,t){return void 0===t&&(t={}),this.session.get("api/v2/nodes/"+e+"/nodes",{params:t})},o.children=function(e,t){return void 0===t&&(t={}),this.nodes(e,t)},o.delete=function(e){return this.session.delete("api/v1/nodes/"+e)},o.download=function(e){var t=e.dataid,o=e.apiVersion,r=void 0===o?"v1":o,n=e.filePath;return P()?this.session.get("api/"+r+"/nodes/"+t+"/content",{responseType:"stream"}).then(function(e){var t=require("fs").createWriteStream(n);return e.data.pipe(t),new Promise(function(e,o){t.on("finish",e),t.on("error",o)})}):Promise.reject("Not implemented yet")},o.audit=function(e){var t=e.apiVersion,o=e.params;return this.session.get("api/"+(void 0===t?"v2":t)+"/nodes/"+e.dataid+"/audit",{params:void 0===o?{}:o})},t}(T),g=/*#__PURE__*/function(){function e(e,t){this.session=void 0,this.mapId=void 0,this.workflowPropertiesInfo=null,this.session=e,this.mapId=t}var t=e.prototype;return t.start=function(){try{var e=this;return Promise.resolve(e.session.workflow.start(e.mapId)).then(function(t){e.workflowPropertiesInfo=t})}catch(e){return Promise.reject(e)}},t.findWorkflowAttribute=function(e){return Object.entries(this.form.schema.properties).find(function(t){return t[1].title===e})},t.setWorkflowAttribute=function(t,o){var r,n=null!=(r=this.findWorkflowAttribute(t))?r:[],i=n[0];if("array"===n[1].type===Array.isArray(o))return this.form.data[i]=o,e;throw new Error("Invalid type.")},t.formUpdate=function(){try{var e=this;return Promise.resolve(e.session.workflow.draftprocessesPut(e.processId,{action:"formUpdate",values:e.form.data}))}catch(e){return Promise.reject(e)}},t.initiate=function(e){var t=void 0===e?{}:e,o=t.comment,r=t.password;try{var n=this;return Promise.resolve(n.formUpdate()).then(function(){var e=u({action:"Initiate"},n.wantComments&&{comment:o},n.wantAuthentication&&{authentication_info:{password:r}});return Promise.resolve(n.session.workflow.draftprocessesPut(n.processId,e))})}catch(e){return Promise.reject(e)}},a(e,[{key:"form",get:function(){return this.workflowPropertiesInfo.forms[0]}},{key:"processId",get:function(){return this.workflowPropertiesInfo.data.process_id}},{key:"attachmentsFolderId",get:function(){var e=this.workflowPropertiesInfo.data.data_packages.find(function(e){return 1===e.type&&1===e.sub_type});return null==e?void 0:e.data.attachment_folder_id}},{key:"wantComments",get:function(){return this.workflowPropertiesInfo.data.comments_on}},{key:"wantAuthentication",get:function(){return this.workflowPropertiesInfo.data.authentication}}])}(),F=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}l(t,e);var o=t.prototype;return o.workflowInitiator=function(e){return new g(this.session,e)},o.start=function(e){var t=this;return this.draftprocesses(e).then(function(e){return e.results.draftprocess_id}).then(function(e){return t.draftprocessesUpdate(e)})},o.draftprocesses=function(e){try{return Promise.resolve(this.session.postForm("api/v2/draftprocesses",{workflow_id:e})).then(function(e){return e.data})}catch(e){return Promise.reject(e)}},o.draftprocessesUpdate=function(e){try{return Promise.resolve(this.session.get("api/v1/forms/draftprocesses/update",{params:{draftprocess_id:e}})).then(function(e){return e.data})}catch(e){return Promise.reject(e)}},o.draftprocessesPut=function(e,t){try{return Promise.resolve(this.session.putForm("api/v2/draftprocesses/"+e,{body:t})).then(function(e){return e.data})}catch(e){return Promise.reject(e)}},t}(T),S=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return l(t,e),t.prototype.scriptNode=function(e,t){return void 0===t&&(t={}),this.session.postForm("api/v1/rhcore/"+e,t)},t}(T),w=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}l(t,e);var o=t.prototype;return o.search=function(e,t){return void 0===t&&(t={}),this.session.postBody("api/v2/search",u({where:e},t))},o.regions=function(e){return void 0===e&&(e={}),this.session.get("api/v1/regions",e)},t}(T),R=/*#__PURE__*/function(e){function t(t){var o;return(o=e.call(this,t)||this).USER=void 0,o.GROUP=void 0,o.USER=0,o.GROUP=1,o}l(t,e);var o=t.prototype;return o.userQuery=function(e,t,o){void 0===t&&(t={}),void 0===o&&(o="v2");var r=u({limit:20,where_type:JSON.stringify([this.USER,this.GROUP]),query:e},t);return this.session.get("api/"+o+"/members",{params:r})},o.member=function(e,t){return void 0===t&&(t="v2"),this.session.get("api/"+t+"/members/"+e)},t}(T),D=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}l(t,e);var o=t.prototype;return o.addVersion=function(e){var t=e.dataid,o=e.fileHandler,r=e.apiVersion,n=void 0===r?"v1":r,i=e.fileName,s=void 0===i?void 0:i,a=e.options,l=void 0===a?{}:a;try{var c=this;console.assert(null!=t,"dataid cannot be null"),console.assert(null!=o,"fileHandler cannot be null");var p="api/"+n+"/nodes/"+t+"/versions";if(P()){var d=require("fs").promises,m=require("path");return Promise.resolve(d.readFile(o)).then(function(e){var t=u({file:{file:e,name:s||m.basename(o)}},l);return c.session.postForm(p,t)})}if(c.session._isFile(o)){var h=u({file:{file:o,name:s||o.name}},l);return Promise.resolve(c.session.postForm(p,h))}throw new Error("Invalid file.")}catch(e){return Promise.reject(e)}},o.download=function(e){var t=e.dataid,o=e.version,r=e.filePath;try{return console.assert(null!=t,"dataid cannot be null"),console.assert(null!=o,"version cannot be null"),console.assert(null!=r,"filePath cannot be null"),P()?Promise.resolve(this.session.get("api/v1/nodes/"+t+"/versions/"+o+"/content",{responseType:"stream"}).then(function(e){var t=require("fs").createWriteStream(r);return e.data.pipe(t),new Promise(function(e,o){t.on("finish",e),t.on("error",o)})})):Promise.reject("Not implemented yet")}catch(e){return Promise.reject(e)}},o.list=function(e){try{return Promise.resolve(this.session.get("api/v1/nodes/"+e+"/versions"))}catch(e){return Promise.reject(e)}},o.version=function(e,t){void 0===t&&(t="latest");try{return Promise.resolve(this.session.get("api/v1/nodes/"+e+"/versions/"+t))}catch(e){return Promise.reject(e)}},o.promote=function(e){var t=e.dataid,o=e.versionNumber,r=e.description,n=void 0===r?null:r;try{return console.assert(null!=t,"dataid cannot be null"),console.assert(null!=o,"number_to_keep must be an integer"),Promise.resolve(this.session.postBody("api/v2/nodes/"+t+"/versions/"+o+"/promote",u({},!!n&&{description:n})))}catch(e){return Promise.reject(e)}},o.deleteVersion=function(e){var t=e.dataid,o=e.versionNumber,r=e.apiVersion,n=void 0===r?"v1":r;try{return console.assert(null!=t,"dataid cannot be null"),console.assert(null!=o,"number_to_keep must be an integer"),Promise.resolve(this.session.delete("api/"+n+"/nodes/"+t+"/versions/"+o))}catch(e){return Promise.reject(e)}},o.purge=function(e){var t=e.dataid,o=e.number_to_keep,r=void 0===o?1:o;try{return console.assert(null!=t,"dataid cannot be null"),console.assert(!isNaN(r),"number_to_keep must be an integer"),Promise.resolve(this.session.deleteForm("api/v2/nodes/"+t+"/versions",{number_to_keep:r}))}catch(e){return Promise.reject(e)}},t}(T),L=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return l(t,e),t.prototype.run=function(e,t){return void 0===t&&(t={}),this.session.get("api/v1/nodes/"+e+"/output",{params:t})},t}(T),M=/*#__PURE__*/function(){function e(e){this.axios=void 0,this._nodes=void 0,this._auth=void 0,this._workflow=void 0,this._rhcore=void 0,this._members=void 0,this._search=void 0,this._webreports=void 0,this._versions=void 0,this.baseUrl=void 0,this.baseUrl=e.baseUrl,this.axios=function(e){var r=function(e){var r=o.create({baseURL:e.baseUrl,paramsSerializer:{indexes:null}});return r.interceptors.response.use(function(e){var o=t(e,"headers.otcsticket");return o&&(r.defaults.headers.common.OTCSTicket=o),e},function(e){return Promise.reject(e)}),r}(e),n=e.username,i=e.password,s=e.otcsticket;if(s)r.defaults.headers.common.OTCSTicket=s;else{if(!n||!i)throw Error("You must provide an otcsticket or username and password.");r.interceptors.request.use(function(r){try{var s;if(null!=(s=r.headers.common)&&s.OTCSTicket)return Promise.resolve(r);var a=b();return a.append("username",n),a.append("password",i),Promise.resolve(P()?o.post(e.baseUrl+"/api/v1/auth/",a.getBuffer(),{headers:a.getHeaders()}):o.post(e.baseUrl+"/api/v1/auth/",a)).then(function(e){return r.headers.OTCSTicket=t(e,"data.ticket"),r})}catch(e){return Promise.reject(e)}})}return r}(e)}var n=e.prototype;return n.rpcClient=function(e){return void 0===e&&(e="/api/v1/rh/rpc/rhnode/"),new v(this,e)},n._isObject=function(e){return e&&"object"==typeof e&&e.constructor===Object},n._isString=function(e){return"string"==typeof e||e instanceof String},n._isBoolean=function(e){return"boolean"==typeof e},n._isFile=function(e){return"string"==typeof(null==e?void 0:e.name)},n.objectToForm=function(e){for(var t=b(),o=0,n=Object.entries(e);o<n.length;o++){var i=n[o],s=i[0],a=i[1];a&&a.name&&a.file?t.append(s,a.file,a.name):Array.isArray(a)||this._isObject(a)||this._isBoolean(a)?t.append(s,JSON.stringify(a)):r(a)||t.append(s,a)}return t},n.putForm=function(e,t){var o=this.objectToForm(t);return P()?this.put(e,o.getBuffer(),{headers:o.getHeaders()}):this.put(e,o)},n.postForm=function(e,t){var o=this.objectToForm(t);return P()?this.post(e,o.getBuffer(),{headers:o.getHeaders(),maxBodyLength:Infinity}):this.post(e,o,{maxBodyLength:Infinity})},n.patchForm=function(e,t){var o=this.objectToForm(t);return P()?this.patch(e,o.getBuffer(),{headers:o.getHeaders()}):this.patch(e,o)},n.deleteForm=function(e,t){return this.delete(e)},n.putBody=function(e,t){return this.putForm(e,{body:t})},n.postBody=function(e,t){return this.postForm(e,{body:t})},n.patchBody=function(e,t){return this.patchForm(e,{body:t})},n.deleteBody=function(e,t){return this.deleteForm(e,{body:t})},n.get=function(e,t){return this.axios.get(e,t)},n.post=function(e,t,o){return this.axios.post(e,t,o)},n.put=function(e,t,o){return this.axios.put(e,t,o)},n.patch=function(e,t,o){return this.axios.patch(e,t,o)},n.options=function(e,t){return this.axios.options(e,t)},n.delete=function(e,t){return this.axios.delete(e,t)},n.$get=function(e,t){try{return Promise.resolve(this.get(e,t)).then(function(e){return e.data})}catch(e){return Promise.reject(e)}},a(e,[{key:"nodes",get:function(){return null==this._nodes&&(this._nodes=new V(this)),this._nodes}},{key:"auth",get:function(){return null==this._auth&&(this._auth=new C(this)),this._auth}},{key:"workflow",get:function(){return null==this._workflow&&(this._workflow=new F(this)),this._workflow}},{key:"rhcore",get:function(){return null==this._rhcore&&(this._rhcore=new S(this)),this._rhcore}},{key:"members",get:function(){return null==this._members&&(this._members=new R(this)),this._members}},{key:"search",get:function(){return null==this._search&&(this._search=new w(this)),this._search}},{key:"webreports",get:function(){return null==this._webreports&&(this._webreports=new L(this)),this._webreports}},{key:"versions",get:function(){return null==this._versions&&(this._versions=new D(this)),this._versions}},{key:"dataTypesEnum",get:function(){return m}}])}(),k=function(e){return void 0!==e.code&&void 0!==e.data};export{v as RPCClient,h as RPCError,M as Session,k as isRPCError};
//# sourceMappingURL=cs-rest.esm.js.map
