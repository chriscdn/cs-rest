!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("axios"),require("lodash.get"),require("lodash.isnil"),require("is-object")):"function"==typeof define&&define.amd?define(["exports","axios","lodash.get","lodash.isnil","is-object"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CSREST={},e.axios,e.get,e.isnil,e.isObject)}(this,(function(e,t,s,r,o){"use strict";var n={AssocType:-18,BooleanType:5,ClassType:9,DapiNodeType:-72,DapiSessionType:-74,DapiStreamType:-68,DapiVersionType:-69,DateType:-7,DynamicType:-127,ErrorType:1,FileType:-107,FrameType:10,IntegerType:2,JavaObjectType:-42,ListType:-2,LongType:-8,ObjectType:-128,ObjRefType:3,RealType:-4,RecArrayType:-110,RecordType:-109,ScriptType:-3,SocketType:-102,StringType:-1,UAPIType:-196,UndefinedType:0,VoidType:8,WAPIWorkType:-75},a={createFormData:()=>new FormData};function i(e){const r=function(e){const r=t.create(e);return r.interceptors.response.use((e=>{const t=s(e,"headers.otcsticket");return t&&(r.defaults.headers.common.OTCSTicket=t),e}),(e=>Promise.reject(e))),r}(e),o=s(e,"username"),n=s(e,"password"),i=s(e,"otcsticket");if(i)r.defaults.headers.common.OTCSTicket=i;else{if(!o||!n)throw Error("You must provide an otcsticket or username and password.");r.interceptors.request.use((async r=>{if(r.headers.common.OTCSTicket)return r;{const i=a.createFormData();i.append("username",o),i.append("password",n);const d=await t.post(`${e.baseURL}/api/v1/auth/`,i);return r.headers.common.OTCSTicket=s(d,"data.ticket"),r}}))}return r}var d=144,p=0,u=2,c=e=>({addablenodetypes:t=>e.get(`api/v1/nodes/${t}/addablenodetypes`),async addDocument({parent_id:t,fileHandler:s,apiVersion:r="v1",name:o=null,options:n={}}){console.assert(null!=t,"parent_id cannot be null"),console.assert(null!=s,"fileHandler cannot be null"),console.assert(["v1","v2"].includes(r),"apiVersion must be in ['v1','v2']");const a=`api/${r}/nodes`;{const r=o||s.name,i={...n,type:d,name:r,parent_id:t,file:{file:s,name:r}};return e.postForm(a,i)}},async addDocumentMajor({parent_id:t,fileHandler:s,name:r=null,description:o=null,options:n={}}){const a=await this.addDocument({parent_id:t,fileHandler:s,name:r,options:{...n,advanced_versioning:!0}}),i=a.data.id;return await e.versions.promote({dataid:i,versionNumber:1,description:o}),await e.versions.deleteVersion({dataid:i,versionNumber:1}),a},addItem:(t,s,r,o={})=>e.postBody("api/v2/nodes",{type:t,parent_id:s,name:r,...o}),node:({dataid:t,apiVersion:s="v2",params:r={}})=>e.get(`api/${s}/nodes/${t}`,{params:r}),ancestors:(t,s={})=>e.get(`api/v1/nodes/${t}/ancestors`,{params:s}),volumeInfo:t=>e.get(`api/v1/volumes/${t}`),volumes:()=>e.get("api/v2/volumes"),addFolder(e,t,s={}){return this.addItem(p,e,t,s)},addGeneration(e,t,s,r,o={}){return this.addItem(u,e,t,{original_id:s,version_number:r,...o})},nodes:(t,s={})=>e.get(`api/v2/nodes/${t}/nodes`,{params:s}),children(e,t={}){return this.nodes(e,t)},delete:t=>e.delete(`api/v1/nodes/${t}`),download:({dataid:e,apiVersion:t="v1",filePath:s})=>Promise.reject("Not implemented yet"),audit:({dataid:t,apiVersion:s="v2",params:r={}})=>e.get(`api/${s}/nodes/${t}/audit`,{params:r})}),l=e=>({start(e){return this.draftprocesses(e).then((e=>s(e,"data.results.draftprocess_id"))).then((e=>this.draftprocesses_update(e)))},draftprocesses:t=>e.postForm("api/v2/draftprocesses",{workflow_id:t}),draftprocesses_update:t=>e.get("api/v1/forms/draftprocesses/update",{params:{draftprocess_id:t}}),draftprocesses_put:(t,s)=>e.putForm(`api/v2/draftprocesses/${t}`,{body:s})}),h=e=>({USER:0,GROUP:1,userQuery(t,s={},r="v2"){const o={limit:20,where_type:JSON.stringify([this.USER,this.GROUP]),query:t,...s};return e.get(`api/${r}/members`,{params:o})},member:(t,s="v2")=>e.get(`api/${s}/members/${t}`)});const m={code:-32603,message:"Internal error"};class y extends Error{code;data;constructor(e=m.message,t=null,s=m.code){o(e)?(super(e.message),this.code=e.code,this.data=e.data):(super(e),this.code=s,this.data=t)}}const b={index:0,get next(){return this.index=this.index+1,this.index}};class v{session;baseURL;_batchQueue;constructor(e,t){this.session=e,this.baseURL=t,this.resetQueue()}requestObject(e,t,s){return{jsonrpc:"2.0",method:e,id:s,params:t}}handleResponse(e){if(Object.prototype.hasOwnProperty.call(e,"result"))return e.result;if(Object.prototype.hasOwnProperty.call(e,"error")){const t=e.error;throw new y(t.message,t.data,t.code)}throw Error("The server did not respond correctly.")}async request(e,t,s=b.next){const r=await this.session.postBody(this.baseURL,{rpc:this.requestObject(e,t,s)});return this.handleResponse(r.data)}resetQueue(){this._batchQueue=[]}queue(e,t,s=b.next){return this._batchQueue.push(this.requestObject(e,t,s)),this}async batch(e=!1){const t=this._batchQueue;this.resetQueue();const r=await this.session.postBody(this.baseURL,{rpc:t});return s(r,"data.data",[]).map((t=>{if(e)return this.handleResponse(t);try{return this.handleResponse(t)}catch(e){return e}}))}rhnode(e,t,s=[],r=b.next){const o={dataid:e,args:s};return this.request(t,o,r)}rhnodeQueue(e,t,s=[],r=b.next){const o={dataid:e,args:s};return this.queue(t,o,r)}}e.Session=class{axios;_nodes;_auth;_workflow;_rhcore;_members;_search;_webreports;_versions;constructor(e){this.axios=i(e)}get nodes(){return null==this._nodes&&(this._nodes=c(this)),this._nodes}get auth(){var e;return null==this._auth&&(this._auth=(e=this,{auth:()=>e.get("/api/v1/auth/")})),this._auth}get workflow(){return null==this._workflow&&(this._workflow=l(this)),this._workflow}get rhcore(){var e;return null==this._rhcore&&(this._rhcore=(e=this,{scriptNode:(t,s={})=>e.get(`api/v1/rhcore/${t}`,{params:s})})),this._rhcore}get members(){return null==this._members&&(this._members=h(this)),this._members}get search(){var e;return null==this._search&&(this._search=(e=this,{search:(t,s={})=>e.postBody("api/v2/search",{where:t,...s}),regions:(t={})=>e.get("api/v1/regions",t)})),this._search}get webreports(){var e;return null==this._webreports&&(this._webreports=(e=this,{run(t,s={}){const r=`api/v1/nodes/${t}/output`;return e.get(r,{params:s})}})),this._webreports}get versions(){var e;return null==this._versions&&(this._versions=(e=this,{async addVersion({dataid:t,fileHandler:s,apiVersion:r="v1",fileName:o=null,options:n={}}){console.assert(null!=t,"dataid cannot be null"),console.assert(null!=s,"fileHandler cannot be null");const a=`api/${r}/nodes/${t}/versions`;{const t={file:{file:s,name:o||s.name},...n};return e.postForm(a,t)}},download:async({dataid:e,version:t,filePath:s})=>(console.assert(null!=e,"dataid cannot be null"),console.assert(null!=t,"version cannot be null"),console.assert(null!=s,"filePath cannot be null"),Promise.reject("Not implemented yet")),async list(t){const s=`api/v1/nodes/${t}/versions`;return e.get(s)},async version(t,s="latest"){const r=`api/v1/nodes/${t}/versions/${s}`;return e.get(r)},async promote({dataid:t,versionNumber:s,description:r=null}){console.assert(null!=t,"dataid cannot be null"),console.assert(null!=s,"number_to_keep must be an integer");const o=`api/v2/nodes/${t}/versions/${s}/promote`;return e.postBody(o,{...!!r&&{description:r}})},async deleteVersion({dataid:t,versionNumber:s,apiVersion:r="v1"}){console.assert(null!=t,"dataid cannot be null"),console.assert(null!=s,"number_to_keep must be an integer");const o=`api/${r}/nodes/${t}/versions/${s}`;return e.delete(o)},async purge({dataid:t,number_to_keep:s=1}){console.assert(null!=t,"dataid cannot be null"),console.assert(!isNaN(s),"number_to_keep must be an integer");const r=`api/v2/nodes/${t}/versions`;return e.deleteForm(r,{number_to_keep:s})}})),this._versions}get dataTypesEnum(){return n}rpcClient(e="/api/v1/rh/rpc/rhnode/"){return new v(this,e)}_isObject(e){return e&&"object"==typeof e&&e.constructor===Object}_isString(e){return"string"==typeof e||e instanceof String}_isBoolean(e){return"boolean"==typeof e}objectToForm(e){const t=a.createFormData();for(const[s,o]of Object.entries(e))o&&o.name&&o.file?t.append(s,o.file,o.name):Array.isArray(o)||this._isObject(o)||this._isBoolean(o)?t.append(s,JSON.stringify(o)):r(o)||t.append(s,o);return t}get(...e){return this.axios.get(...e)}putForm(e,t){const s=this.objectToForm(t);return this.put(e,s)}postForm(e,t){const s=this.objectToForm(t);return this.post(e,s,{maxBodyLength:1/0})}patchForm(e,t){const s=this.objectToForm(t);return this.patch(e,s)}deleteForm(e,t){const s=this.objectToForm(t);return this.delete(e,s)}putBody(e,t){return this.putForm(e,{body:t})}postBody(e,t){return this.postForm(e,{body:t})}patchBody(e,t){return this.patchForm(e,{body:t})}deleteBody(e,t){return this.deleteForm(e,{body:t})}post(...e){return this.axios.post(...e)}put(...e){return this.axios.put(...e)}delete(...e){return this.axios.delete(...e)}options(...e){return this.axios.options(...e)}patch(...e){return this.axios.patch(...e)}}}));
//# sourceMappingURL=index.umd.min.js.map
